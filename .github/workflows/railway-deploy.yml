name: Deploy to Railway
on:
  push:
    branches: [ "main" ]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - run: npm ci
      - uses: railwayapp/railway-action@v3
        with:
          railwayToken: ${{ secrets.RAILWAY_TOKEN }}
      - name: Deploy service
        run: railway up --service "${{ secrets.RAILWAY_SERVICE_NAME }}"
      - name: Set variables (optional)
        run: |
          railway variables set --service "${{ secrets.RAILWAY_SERVICE_NAME }}" RPC_TARGET="${{ secrets.RPC_TARGET }}"
          if [ -n "${{ secrets.SSE_TARGET }}" ]; then railway variables set --service "${{ secrets.RAILWAY_SERVICE_NAME }}" SSE_TARGET="${{ secrets.SSE_TARGET }}"; fi
